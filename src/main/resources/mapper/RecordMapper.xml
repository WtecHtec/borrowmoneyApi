<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.dao.mapper.RecordMapper">
  <resultMap id="BaseResultMap" type="com.example.demo.dao.pojo.Record">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Apr 01 21:12:49 CST 2020.
    -->
    <result column="recordid" jdbcType="VARCHAR" property="recordid" />
    <result column="userid" jdbcType="VARCHAR" property="userid" />
    <result column="payeename" jdbcType="VARCHAR" property="payeename" />
    <result column="payeeemail" jdbcType="VARCHAR" property="payeeemail" />
    <result column="money" jdbcType="INTEGER" property="money" />
    <result column="createtime" jdbcType="TIMESTAMP" property="createtime" />
    <result column="status" jdbcType="VARCHAR" property="status" />
    <result column="repaytime" jdbcType="TIMESTAMP" property="repaytime" />
    <result column="remindtime" jdbcType="TIMESTAMP" property="remindtime" />
    <result column="del" jdbcType="INTEGER" property="del" />

  </resultMap>
  <insert id="insert" parameterType="com.example.demo.dao.pojo.Record">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Apr 01 21:12:49 CST 2020.
    -->
    insert into record (recordid, userid, payeename, 
      payeeemail, money, createtime, 
      status, repaytime, remindtime,del
      )
    values (#{recordid,jdbcType=INTEGER}, #{userid,jdbcType=INTEGER}, #{payeename,jdbcType=VARCHAR}, 
      #{payeeemail,jdbcType=VARCHAR}, #{money,jdbcType=INTEGER}, #{createtime,jdbcType=TIMESTAMP}, 
      #{status,jdbcType=VARCHAR}, #{repaytime,jdbcType=TIMESTAMP}, #{remindtime,jdbcType=TIMESTAMP},
    #{del}
      )
  </insert>
  <select id="selectAll" resultMap="BaseResultMap" parameterType="com.example.demo.dao.pojo.Record">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Apr 01 21:12:49 CST 2020.
    -->
    select recordid, userid, payeename, payeeemail, money, createtime, status, repaytime,
    remindtime,del
    from record
    <where>
      <if test=" recordid != null">
        recordid = #{recordid}
      </if>
    </where>
    ORDER BY  createtime DESC
  </select>

  <select id="reportData" parameterType="java.lang.String" resultMap="BaseResultMap" >
     select
     <if test="_parameter != null">
       SUM(r.money) as money
     </if>
    <if test="_parameter == null">
      SUM(r.money) as money ,r.payeename as payeename
    </if>
      FROM record r
    <where>
      <if test="_parameter != null">
         DATE_FORMAT( r.createtime,'%Y-%m') = #{createTime,jdbcType=VARCHAR}
      </if>
    </where>
    <if test="_parameter == null">
      GROUP BY r.payeename
    </if>
  </select>


   <update id="updateRcord" parameterType="com.example.demo.dao.pojo.Record">
       update record
       <set>
         <if test="status != null">
           status = #{status},
         </if>
         <if test=" del != null">
           del = #{del},
         </if>
         <if test="remindtime != null">
           remindtime = #{remindtime},
         </if>

         <if test="repaytimeStr != null">
           repaytime = #{repaytimeStr},
         </if>
       </set>
    where recordid = #{recordid}
   </update>

  <select id="getSendInfo" resultType="com.example.demo.dao.pojo.Record" >

    select  r.*,
    r.createtime as createtimeStr,
    r.repaytime as repaytimeStr,
    u.username
    FROM record r
    LEFT JOIN user u ON u.userid = r.userid
     WHERE r.del = 0 AND r.status = 1  AND DATE_FORMAT(r.repaytime,'%Y-%m-%d') = #{param}
  </select>


  <select id="selectById" resultMap="BaseResultMap" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Apr 01 21:12:49 CST 2020.
    -->
    select recordid, userid, payeename, payeeemail, money, createtime, status, repaytime,
    remindtime,del
    from record
    <where>
        recordid = #{recordid}
    </where>

  </select>

</mapper>